<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>渣渣熊窝</title>
  <meta name="description" content="AI Chatbot                                  :root {             color-scheme: light;         }         body.web-page {             font-family: &#39;Inter&#39;, &#39;Poppins&#39;, -apple-system, Blin">
<meta property="og:type" content="website">
<meta property="og:title" content="渣渣熊窝">
<meta property="og:url" content="https://www.zhazhabear.site/downloads/OllamaStreamGenerateInterface.html">
<meta property="og:site_name" content="渣渣熊窝">
<meta property="og:description" content="AI Chatbot                                  :root {             color-scheme: light;         }         body.web-page {             font-family: &#39;Inter&#39;, &#39;Poppins&#39;, -apple-system, Blin">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-18T14:18:00.595Z">
<meta property="article:modified_time" content="2025-10-18T14:17:11.423Z">
<meta property="article:author" content="zzbear">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://www.zhazhabear.site/downloads/OllamaStreamGenerateInterface.html">
  
  
    <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 7.3.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/zhazha-xiong" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">渣渣熊</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Dalian, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository/">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links/">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about/">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/zhazha-xiong" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E5%9E%8B%E6%94%AF%E4%BB%98%E5%95%86%E5%9F%8E%E5%AD%A6%E4%B9%A0/">小型支付商城学习</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Natapp/" rel="tag">Natapp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ollama/" rel="tag">Ollama</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Portainer/" rel="tag">Portainer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAG/" rel="tag">RAG</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-ai/" rel="tag">Spring ai</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2/" rel="tag">前端页面</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">后端开发</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" rel="tag">微信登录</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1/" rel="tag">支付宝沙箱</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/" rel="tag">项目学习</a><span class="tag-list-count">9</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Docker/" style="font-size: 13.2px;">Docker</a> <a href="/tags/Natapp/" style="font-size: 13px;">Natapp</a> <a href="/tags/Ollama/" style="font-size: 13.4px;">Ollama</a> <a href="/tags/Portainer/" style="font-size: 13px;">Portainer</a> <a href="/tags/PostgreSQL/" style="font-size: 13px;">PostgreSQL</a> <a href="/tags/RAG/" style="font-size: 13.4px;">RAG</a> <a href="/tags/Spring-ai/" style="font-size: 13.6px;">Spring ai</a> <a href="/tags/redis/" style="font-size: 13px;">redis</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2/" style="font-size: 13.2px;">前端页面</a> <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 13.8px;">后端开发</a> <a href="/tags/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" style="font-size: 13px;">微信登录</a> <a href="/tags/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1/" style="font-size: 13px;">支付宝沙箱</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 13px;">运维</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/" style="font-size: 14px;">项目学习</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">十月 2025</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">九月 2025</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/18/OllamaRAG%E7%9F%A5%E8%AF%86%E5%BA%93%E6%8E%A5%E5%8F%A3%E9%A1%B5%E9%9D%A2%E5%AF%B9%E6%8E%A5/" class="title">Ollama RAG 知识库接口页面对接</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-18T11:23:00.000Z" itemprop="datePublished">2025-10-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/18/OllamaRAG%E7%9F%A5%E8%AF%86%E5%BA%93%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0/" class="title">Ollama RAG 知识库接口服务实现</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-18T06:33:00.000Z" itemprop="datePublished">2025-10-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/18/OllamaRAG%E7%9F%A5%E8%AF%86%E5%BA%93%E4%B8%8A%E4%BC%A0%E3%80%81%E8%A7%A3%E6%9E%90%E5%92%8C%E9%AA%8C%E8%AF%81/" class="title">Ollama RAG 知识库上传、解析和验证</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-18T06:16:00.000Z" itemprop="datePublished">2025-10-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/15/Ollama%E6%B5%81%E5%BC%8F%E5%BA%94%E7%AD%94%E6%8E%A5%E5%8F%A3%E9%A1%B5%E9%9D%A2%E5%AF%B9%E6%8E%A5/" class="title">Ollama流式应答接口页面对接</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-15T11:31:00.000Z" itemprop="datePublished">2025-10-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/AI-Agent%E5%AD%A6%E4%B9%A0/">AI Agent学习</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/15/Ollama%E6%B5%81%E5%BC%8F%E5%BA%94%E7%AD%94%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0/" class="title">Ollama流式应答接口实现</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-15T07:45:00.000Z" itemprop="datePublished">2025-10-15</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="page-" class="article article-type-page" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/downloads/OllamaStreamGenerateInterface.html" class="article-date">
	  <time datetime="2025-10-18T14:18:00.595Z" itemprop="datePublished">2025-10-18</time>
	</a>
</span>
        
        

        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/downloads/OllamaStreamGenerateInterface.html#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnF4j8kH9Yp5VX1nA2nayJ9uj9Y6p9cHfGppRy5JyE2tdI9lbEKeosFVJeFt3PcTJS3BM4tiTqcK3wwD5cqvug==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: light;
        }
        body.web-page {
            font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: radial-gradient(circle at 15% 20%, rgba(151, 190, 255, 0.22), transparent 55%),
                        radial-gradient(circle at 85% 10%, rgba(120, 180, 255, 0.18), transparent 50%),
                        linear-gradient(180deg, #F4F7FB 0%, #E3F0FF 100%);
            min-height: 100vh;
            color: #1F2430;
        }
        .glass-card {
            backdrop-filter: blur(10px);
            background: rgba(243, 248, 255, 0.9);
            border: 1px solid rgba(138, 163, 210, 0.2);
            box-shadow: 0 16px 36px -24px rgba(34, 61, 120, 0.28);
        }
        .signal-gradient {
            background: linear-gradient(90deg, #5A8DEE 0%, #7AD1F8 100%);
        }
        #conversation {
            max-height: 60vh;
        }
        /* Markdown 样式 */
        .ai-message pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
        }
        .ai-message code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        .ai-message pre code {
            background: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
        }
        .ai-message h1, .ai-message h2, .ai-message h3 {
            color: #1f2937;
            margin: 16px 0 8px 0;
            font-weight: 600;
        }
        .ai-message h1 { font-size: 1.5em; }
        .ai-message h2 { font-size: 1.25em; }
        .ai-message h3 { font-size: 1.125em; }
        .ai-message p { margin: 8px 0; line-height: 1.6; }
        .ai-message ul, .ai-message ol {
            margin: 8px 0;
            padding-left: 24px;
        }
        .ai-message li { margin: 4px 0; }
        .ai-message blockquote {
            border-left: 4px solid #e5e7eb;
            padding-left: 16px;
            margin: 12px 0;
            color: #6b7280;
            font-style: italic;
        }
        .ai-message table {
            border-collapse: collapse;
            margin: 12px 0;
            width: 100%;
        }
        .ai-message th, .ai-message td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }
        .ai-message th {
            background: #f9fafb;
            font-weight: 600;
        }
    </style>
</head>
<body class="web-page">
    <div class="max-w-screen-xl mx-auto h-screen px-6 md:px-10 pt-10 pb-16 flex flex-col">
        <header class="mb-10 flex flex-col md:flex-row md:items-center md:justify-between gap-5">
            <div class="flex items-center gap-3">
                <span class="w-12 h-12 rounded-2xl signal-gradient flex items-center justify-center text-white text-2xl font-semibold shadow-lg shadow-blue-100/60"></span>
                <div>
                    <h1 class="text-2xl font-semibold tracking-tight text-slate-800">AI Chatbot</h1>
                    <p class="text-sm text-slate-500">Deepseek R1:1.5B</p>
                </div>
            </div>
            <div class="glass-card rounded-2xl px-6 py-4 flex items-center gap-4 max-w-2xl">
                <div class="min-w-[140px]">
                    <p class="text-xs uppercase tracking-[0.18em] text-slate-500">当前模式</p>
                    <p id="modeLabel" class="text-lg font-semibold text-slate-700">普通请求</p>
                </div>
                <div class="flex-1 text-xs text-slate-500 leading-relaxed">
                    <p id="modeDescription">一次性返回完整消息。</p>
                    <p id="modeHint" class="mt-1">点击底部按钮可切换至流式模式。</p>
                </div>
                <button id="logToggle" type="button" class="shrink-0 h-11 px-4 rounded-xl border border-slate-200/80 text-sm font-medium text-slate-600 flex items-center gap-2 transition hover:border-sky-300 hover:text-sky-600">
                    <i class="fa-regular fa-file-lines"></i>
                    查看日志
                </button>
            </div>
        </header>

        <main class="flex-1 flex flex-col overflow-hidden">
            <section class="glass-card rounded-3xl flex-1 overflow-hidden flex flex-col">
                <div class="px-8 pt-8 pb-4 border-b border-slate-200/60">
                    <h2 class="text-sm font-semibold text-slate-600 uppercase tracking-wide">对话区</h2>
                    <p class="text-xs text-slate-500 mt-1">用于展示实时的模型回复与用户消息。</p>
                </div>
                <div id="conversation" class="flex-1 px-8 py-6 overflow-y-auto space-y-4">
                    <div class="h-full flex flex-col items-center justify-center text-sm text-slate-400" data-empty-state="true">
                        <i class="fa-regular fa-comment-dots text-xl mb-2"></i>
                        <p>还没有消息，输入内容开始对话吧。</p>
                    </div>
                </div>
            </section>

            <section class="mt-8">
                <form class="glass-card rounded-3xl px-6 py-4 flex flex-col md:flex-row gap-4 md:items-center" id="chatForm">
                    <button type="button" id="modeToggle" class="w-full md:w-auto md:min-w-[160px] h-12 rounded-2xl border border-sky-200/70 text-sky-600 text-sm font-medium flex items-center justify-center gap-2 transition hover:border-sky-400 hover:text-sky-700">
                        <i class="fa-solid fa-repeat"></i>
                        <span id="modeToggleLabel">切换到流式请求</span>
                    </button>
                    <div class="flex-1 flex items-center gap-3">
                        <input type="text" id="messageInput" class="flex-1 h-12 rounded-2xl border border-transparent bg-white/85 px-4 text-sm text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-200" placeholder="直接输入内容即可，不需要命令" autocomplete="off" required>
                        <button type="submit" class="w-12 h-12 rounded-2xl signal-gradient text-white flex items-center justify-center text-lg shadow-md shadow-blue-200/60 transition hover:shadow-lg hover:-translate-y-0.5">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <aside id="logPanel" class="hidden fixed bottom-6 right-6 w-[320px] max-h-[60vh] glass-card rounded-3xl p-5 flex flex-col shadow-2xl shadow-blue-200/50">
        <div class="flex items-center justify-between mb-3">
            <div>
                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">请求日志</p>
                <p class="text-sm font-semibold text-slate-700">最近活动</p>
            </div>
            <button id="logClose" type="button" class="w-9 h-9 rounded-lg border border-slate-200/80 text-slate-400 hover:text-slate-600 hover:border-sky-300 transition">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto pr-1">
            <ul id="logList" class="space-y-3 text-xs text-slate-500"></ul>
        </div>
        <button id="logClear" type="button" class="mt-4 w-full h-10 rounded-xl border border-slate-200/80 text-[13px] text-slate-500 hover:border-sky-300 hover:text-sky-600 transition">清空日志</button>
    </aside>

    <script>
        const DEFAULT_MODEL = 'deepseek-r1:1.5b';

        const modeToggle = document.getElementById('modeToggle');
        const modeToggleLabel = document.getElementById('modeToggleLabel');
        const modeLabel = document.getElementById('modeLabel');
        const modeDescription = document.getElementById('modeDescription');
        const modeHint = document.getElementById('modeHint');
        const logToggle = document.getElementById('logToggle');
        const logPanel = document.getElementById('logPanel');
        const logClose = document.getElementById('logClose');
        const logClear = document.getElementById('logClear');
        const logList = document.getElementById('logList');
        const messageInput = document.getElementById('messageInput');
        const conversation = document.getElementById('conversation');
        const chatForm = document.getElementById('chatForm');
        const submitButton = chatForm.querySelector('button[type="submit"]');

        const modes = {
            standard: {
                name: '普通请求',
                description: '一次性返回完整消息。',
                hint: '点击底部按钮可切换至流式模式。',
                toggleText: '切换到流式请求',
                next: 'stream'
            },
            stream: {
                name: '流式请求',
                description: '逐段返回，适合实时展示。',
                hint: '点击底部按钮可切换至普通模式。',
                toggleText: '切换到普通请求',
                next: 'standard'
            }
        };

        let currentMode = 'standard';
        let isRequestPending = false;
        const logs = [];
        const sentMessages = []; // 用于存储用户发送的消息
        let historyIndex = -1;   // 用于追踪历史记录的位置

        function updateModeUI() {
            const { name, description, hint, toggleText } = modes[currentMode];
            modeLabel.textContent = name;
            modeDescription.textContent = description;
            modeHint.textContent = hint;
            modeToggleLabel.textContent = toggleText;
            modeToggle.dataset.mode = currentMode;
            modeToggle.setAttribute('aria-pressed', currentMode === 'stream');
            modeToggle.title = `${name} · ${description}`;
        }

        function createMessagePreview(text) {
            const trimmed = text.replace(/\s+/g, ' ').trim();
            return trimmed.length > 60 ? `${trimmed.slice(0, 60)}…` : trimmed;
        }

        function removeEmptyState() {
            const emptyState = conversation.querySelector('[data-empty-state]');
            if (emptyState) {
                emptyState.remove();
            }
        }

        function appendUserMessage(text) {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex justify-end';

            const bubble = document.createElement('div');
            bubble.className = 'max-w-[70%] rounded-3xl bg-sky-100/80 px-4 py-3 text-sm text-slate-700 leading-relaxed shadow-sm whitespace-pre-wrap break-words';
            bubble.textContent = text;

            wrapper.appendChild(bubble);
            conversation.appendChild(wrapper);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function appendAssistantMessage(initialText = '模型生成中…') {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex gap-3';

            const avatar = document.createElement('div');
            avatar.className = 'w-9 h-9 rounded-full signal-gradient text-white flex items-center justify-center shadow-md';
            avatar.innerHTML = '<i class="fa-solid fa-robot"></i>';

            const body = document.createElement('div');
            body.className = 'max-w-[72%] rounded-3xl bg-white/90 border border-slate-200/60 px-4 py-3 text-sm text-slate-700 leading-relaxed shadow-sm whitespace-pre-wrap break-words ai-message';

            const thinkDiv = document.createElement('div');
            thinkDiv.className = 'mb-2 text-xs text-slate-400 bg-slate-50/50 px-2 py-1 rounded-lg border-l-2 border-slate-300';
            thinkDiv.style.display = 'none';
            thinkDiv.innerHTML = '<strong>深度思考...</strong><br>';

            const contentDiv = document.createElement('div');
            contentDiv.textContent = initialText;

            body.appendChild(thinkDiv);
            body.appendChild(contentDiv);

            wrapper.append(avatar, body);
            conversation.appendChild(wrapper);
            conversation.scrollTop = conversation.scrollHeight;
            return { bubble: body, thinkDiv, contentDiv };
        }

        function appendSystemMessage(text) {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex gap-3';

            const badge = document.createElement('div');
            badge.className = 'w-9 h-9 rounded-full bg-rose-100 text-rose-500 flex items-center justify-center shadow-sm';
            badge.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>';

            const body = document.createElement('div');
            const bubble = document.createElement('div');
            bubble.className = 'max-w-[72%] rounded-3xl bg-white border border-rose-200 px-4 py-3 text-sm text-rose-600 leading-relaxed whitespace-pre-wrap break-words';
            bubble.textContent = text;
            body.appendChild(bubble);

            wrapper.append(badge, body);
            conversation.appendChild(wrapper);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function addLog(text) {
            logs.unshift({ text, timestamp: new Date().toLocaleTimeString() });
            if (logs.length > 120) {
                logs.pop();
            }
            renderLogs();
        }

        function renderLogs() {
            logList.innerHTML = '';
            if (!logs.length) {
                const emptyItem = document.createElement('li');
                emptyItem.className = 'text-slate-400 text-center py-4';
                emptyItem.textContent = '暂无日志';
                logList.appendChild(emptyItem);
                return;
            }

            logs.forEach(({ text, timestamp }) => {
                const item = document.createElement('li');
                item.className = 'rounded-2xl border border-slate-200/60 bg-white/80 px-3 py-2.5 shadow-sm';
                item.innerHTML = `
                    <p class="text-[11px] text-slate-400">${timestamp}</p>
                    <p class="mt-1 text-slate-600 leading-relaxed">${text}</p>
                `;
                logList.appendChild(item);
            });
        }

        function toggleFormDisabled(disabled) {
            submitButton.disabled = disabled;
            messageInput.disabled = disabled;
            modeToggle.disabled = disabled;
            submitButton.classList.toggle('opacity-60', disabled);
            submitButton.classList.toggle('cursor-not-allowed', disabled);
            messageInput.classList.toggle('opacity-70', disabled);
        }

        modeToggle.addEventListener('click', () => {
            if (isRequestPending) return;
            currentMode = modes[currentMode].next;
            updateModeUI();
        });

        logToggle.addEventListener('click', () => {
            logPanel.classList.toggle('hidden');
            if (!logPanel.classList.contains('hidden')) {
                renderLogs();
            }
        });

        logClose.addEventListener('click', () => {
            logPanel.classList.add('hidden');
        });

        logClear.addEventListener('click', () => {
            logs.length = 0;
            renderLogs();
        });

        chatForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const text = messageInput.value.trim();
            if (!text || isRequestPending) {
                return;
            }

            // 添加到历史记录
            if (sentMessages[0] !== text) {
                sentMessages.unshift(text);
            }
            historyIndex = -1; // 重置历史记录索引

            removeEmptyState();
            appendUserMessage(text);
            messageInput.value = '';
            messageInput.focus();

            const preview = createMessagePreview(text);
            addLog(`准备发送 ${modes[currentMode].name}：${preview}`);

            const aiBubble = appendAssistantMessage();

            isRequestPending = true;
            toggleFormDisabled(true);

            try {
                await dispatchRequest(text, aiBubble);
            } catch (error) {
                console.error(error);
                addLog(`${modes[currentMode].name} 请求失败：${error.message}`);
                appendSystemMessage(`请求失败：${error.message}`);
            } finally {
                isRequestPending = false;
                toggleFormDisabled(false);
            }
        });

        async function dispatchRequest(message, aiBubble) {
            const endpoint = currentMode === 'standard' ? 'generate' : 'generate_stream';
            const url = `/api/v1/ollama/${endpoint}?model=${encodeURIComponent(DEFAULT_MODEL)}&message=${encodeURIComponent(message)}`;
            addLog(`请求 URL：${url}`);

            try {
                if (currentMode === 'standard') {
                    const { status } = await handleStandardRequest(url, aiBubble);
                    addLog(`普通请求成功 · HTTP ${status}`);
                } else {
                    const { status } = await handleStreamRequest(url, aiBubble);
                    addLog(`流式请求成功 · HTTP ${status}`);
                }
            } catch (error) {
                aiBubble.contentDiv.innerHTML = marked.parse(`请求失败：${error.message}`);
                throw error;
            }
        }

        async function handleStandardRequest(url, aiBubble) {
            const response = await fetch(url);
            const status = response.status;
            if (!response.ok) {
                const errorText = await response.text().catch(() => '');
                throw new Error(`HTTP ${status}${errorText ? ` · ${errorText}` : ''}`);
            }

            const contentType = response.headers.get('content-type') || '';
            let fullText;
            if (contentType.includes('application/json')) {
                const data = await response.json();
                fullText = extractContent(data);
            } else {
                fullText = await response.text();
            }

            // 解析 think 和正文
            const thinkMatch = fullText.match(/<think>([\s\S]*?)<\/think>/);
            const thinkContent = thinkMatch ? thinkMatch[1].trim() : '正在思考中...';
            const mainContent = fullText.replace(/<think>[\s\S]*?<\/think>\s*/, '').trim();

            aiBubble.thinkDiv.style.display = 'block';
            aiBubble.thinkDiv.innerHTML = '<strong>深度思考完毕</strong><br>' + thinkContent.replace(/\n/g, '<br>');

            aiBubble.contentDiv.innerHTML = marked.parse(mainContent || '（模型没有返回内容）');
            conversation.scrollTop = conversation.scrollHeight;
            return { status };
        }

        async function handleStreamRequest(url, aiBubble) {
            const response = await fetch(url);
            const status = response.status;
            if (!response.ok) {
                const errorText = await response.text().catch(() => '');
                throw new Error(`HTTP ${status}${errorText ? ` · ${errorText}` : ''}`);
            }

            // 重置内容
            aiBubble.contentDiv.textContent = '';
            aiBubble.thinkDiv.style.display = 'none';
            
            const data = await response.json();

            if (Array.isArray(data)) {
                // 后端返回的是一个完整的JSON数组
                let fullText = '';
                for (const item of data) {
                    const content = extractContent(item);
                    if (content) {
                        fullText += content;
                        // 直接更新文本内容，不再调用会重新渲染的函数
                        updateStreamDisplay(fullText, aiBubble, true);
                    }
                    // 添加延迟，模拟流式效果
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            } else {
                // 处理其他可能的JSON结构或错误
                const content = extractContent(data);
                if (content) {
                    updateStreamDisplay(content, aiBubble, false);
                } else {
                    aiBubble.contentDiv.innerHTML = marked.parse('（模型没有返回有效内容）');
                }
            }

            return { status };
        }

        // 从单行数据中提取内容
        // function extractContentFromLine(line) { ... } // 此函数已不再需要

        // 更新流式显示
        function updateStreamDisplay(fullText, aiBubble, isStreaming) {
            // 处理 think 标签
            const thinkMatch = fullText.match(/<think>([\s\S]*?)(<\/think>|$)/);

            if (thinkMatch) {
                if (!thinkMatch[2]) { // 思考中
                    const thinkContent = thinkMatch[1];
                    aiBubble.thinkDiv.style.display = 'block';
                    aiBubble.thinkDiv.innerHTML = '<strong>深度思考中...</strong><br>' +
                        thinkContent.replace(/\n/g, '<br>');
                    aiBubble.contentDiv.textContent = '';
                } else { // 思考完成
                    const thinkContent = thinkMatch[1].trim();
                    aiBubble.thinkDiv.style.display = 'block';
                    aiBubble.thinkDiv.innerHTML = '<strong>深度思考完毕</strong><br>' +
                        thinkContent.replace(/\n/g, '<br>');

                    // 提取并显示主要内容
                    const mainContent = fullText.replace(/<think>[\s\S]*?<\/think>\s*/, '').trim();
                    aiBubble.contentDiv.innerHTML = marked.parse(mainContent);
                }
            } else {
                // 直接显示主要内容
                aiBubble.contentDiv.innerHTML = marked.parse(fullText);
            }

            conversation.scrollTop = conversation.scrollHeight;
        }

        // 逐字显示内容
        // displayContentGradually 函数已完全删除，不再需要

        // 处理非流式响应
        // async function processCompleteResponse(text, aiBubble) { ... } // 此函数已不再需要

        function extractContent(data) {
            if (!data) return '';
            if (typeof data === 'string') return data;

            const maybeContent =
                data?.result?.output?.content ??
                data?.result?.output?.text ??
                data?.output?.content ??
                data?.message ??
                data?.choices?.[0]?.message?.content ??
                data?.results?.[0]?.output?.content;

            if (Array.isArray(maybeContent)) {
                return maybeContent.map((item) => {
                    if (typeof item === 'string') return item;
                    if (item?.text) return item.text;
                    return '';
                }).join('\n');
            }

            if (typeof maybeContent === 'object' && maybeContent !== null) {
                if (maybeContent.text) return maybeContent.text;
                return '';
            }

            if (maybeContent) {
                return String(maybeContent);
            }

            return '';
        }

        // 初始化界面
        updateModeUI();
        renderLogs();

        messageInput.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (sentMessages.length > 0 && historyIndex < sentMessages.length - 1) {
                    historyIndex++;
                    messageInput.value = sentMessages[historyIndex];
                    messageInput.setSelectionRange(messageInput.value.length, messageInput.value.length);
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    messageInput.value = sentMessages[historyIndex];
                    messageInput.setSelectionRange(messageInput.value.length, messageInput.value.length);
                } else if (historyIndex <= 0) {
                    historyIndex = -1;
                    messageInput.value = '';
                }
            }
        });
    </script>
</body>
</html>
      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://www.zhazhabear.site/downloads/OllamaStreamGenerateInterface.html" title="" target="_blank" rel="external">https://www.zhazhabear.site/downloads/OllamaStreamGenerateInterface.html</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/zhazha-xiong" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/zhazha-xiong" target="_blank"><span class="text-dark">渣渣熊</span><small class="ml-1x"></small></a></h3>
        <div>个人简介。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/zhazha-xiong" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   <!-- 注释掉评论系统脚本 -->
   








<script src="https://cdn.jsdelivr.net/npm/mermaid@10.4.0/dist/mermaid.min.js"></script>
<script>
  // 初始化mermaid
  if (typeof mermaid !== 'undefined') {
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose'
    });
  }
</script>
</body>
</html>